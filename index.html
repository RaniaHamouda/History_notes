<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ù†ØµØ© Ø¹Ø§Ø´Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® | Ancient History Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* ØªØ®ØµÙŠØµ Ø®Ø· Ø¹Ø±Ø¨ÙŠ Ù…Ù†Ø§Ø³Ø¨ */
      @import url("https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap");
      body {
        font-family: "Tajawal", sans-serif;
        background-color: #050505;
        opacity: 1;
        color: #eaeaea;
      }
      /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© */
      .gold-color {
        color: #d4af37;
      }
      .gold-border {
        border-color: #d4af37;
      }
      .gold-bg {
        background-color: #d4af37;
      }

      /* Ø§Ù„Ø¸Ù„Ø§Ù„ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© */
      .gold-shadow {
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
      }
      .lesson-card,
      .char-card,
      .quiz-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        border-left: 4px solid #d4af3750;
      }
      .lesson-card:hover,
      .char-card:hover,
      .quiz-card:hover {
        transform: translateY(-7px);
        box-shadow: 0 15px 30px rgba(212, 175, 55, 0.5);
      }

      /* **** Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙØ¹Ø¯Ù„ Ù„Ù„Ø®Ù„ÙÙŠØ© (Ø£ØºÙ…Ù‚ ÙˆØ£Ù‡Ø¯Ø£) **** */
      .hero-bg {
        background-color: #050505;
        opacity: 1;

        background-image:
            /* Ø·Ø¨Ù‚Ø© ØªØ¸Ù„ÙŠÙ„ Ø¯Ø§ÙƒÙ†Ø© ÙÙˆÙ‚ Ø§Ù„ØµÙˆØ±Ø© Ù„ØªØºÙ…ÙŠÙ‚Ù‡Ø§ */ linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          /* Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø§Ø¹Ù…Ø© */
            radial-gradient(
              circle at 10% 20%,
              rgba(16, 16, 16, 0.3) 0%,
              rgba(5, 5, 5, 0.8) 100%
            ),
          /* Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© */ url(/images/bg.png);

        background-size: cover;
        background-attachment: fixed;
        /* Ø­Ø±ÙƒØ© Ø£Ù†Ø¹Ù… ÙˆØ£Ù‡Ø¯Ø£ (20 Ø«Ø§Ù†ÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 10) */
        animation: subtle-pulse 20s infinite alternate ease-in-out;
      }
      @keyframes subtle-pulse {
        from {
          background-position: 0% 0%;
        }
        to {
          background-position: 100% 100%;
        }
      }

      .delete-btn {
        background-color: #5c0000;
        transition: background-color 0.2s, box-shadow 0.2s;
      }
      .delete-btn:hover {
        background-color: #7a0000;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
      }

      /* ØªØµÙ…ÙŠÙ… Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
      .password-container {
        position: relative;
      }
      .toggle-password {
        position: absolute;
        left: 10px; /* Adjust for RTL */
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #d4af37;
        padding: 5px;
        z-index: 10;
      }
      /* ØªØµÙ…ÙŠÙ… Ø²Ø± ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ø¯ÙŠØ± */
      .admin-set-btn {
        background-color: #384210;
        transition: background-color 0.2s, box-shadow 0.2s;
      }
      .admin-set-btn:hover {
        background-color: #5b7029;
      }

      /* Ù„ØªÙƒØ¨ÙŠØ± Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      .nav-icon {
        font-size: 1.25rem; /* text-xl */
        margin-left: 0.25rem;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© */
      .live-btn {
        background-color: #008000; /* Ø£Ø®Ø¶Ø± Ø²ÙˆÙ… Ø£Ùˆ Ù…ÙŠØª */
        transition: background-color 0.3s, transform 0.3s;
      }
      .live-btn:hover {
        background-color: #00a000;
        transform: scale(1.05);
      }

      /* ØªØµÙ…ÙŠÙ… Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ÙØµÙ„ */
      #auth-card {
        background-color: #1a1a1a;
        border: 2px solid #d4af37;
        animation: fadeIn 0.5s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body class="hero-bg">
    <div id="auth-modal-container">
      <div
        id="auth-modal"
        class="fixed inset-0 bg-black bg-opacity-75 z-[100] hidden flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300"
      >
        <div id="auth-card" class="p-8 rounded-xl w-full max-w-md gold-shadow">
          <div
            class="flex justify-between items-center mb-6 border-b gold-border pb-2"
          >
            <h3 class="text-2xl gold-color font-bold" id="auth-title">
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </h3>
            <button
              onclick="closeAuthModal()"
              class="text-white hover:gold-color text-2xl"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>

          <form id="login-form" class="space-y-4">
            <div>
              <input
                type="email"
                id="login-email"
                required
                placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
            </div>
            <div class="password-container">
              <input
                type="password"
                id="login-password"
                required
                placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
              <i
                class="fas fa-eye toggle-password"
                data-target="login-password"
                onclick="togglePasswordVisibility(this)"
              ></i>
            </div>

            <button
              type="submit"
              class="w-full py-3 gold-bg text-gray-900 font-bold rounded-lg gold-shadow hover:bg-yellow-500 transition"
            >
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            <p class="text-center text-sm text-gray-400 mt-4">
              Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ
              <a
                href="#"
                id="switch-to-signup"
                class="gold-color hover:text-yellow-500"
                >Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a
              >
            </p>
            <div
              id="auth-message-box"
              class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow bg-gray-700 text-yellow-300"
            ></div>
          </form>

          <form id="signup-form" class="space-y-4 hidden">
            <div>
              <input
                type="text"
                id="signup-name"
                required
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Admin Ù„Ù„ÙˆØµÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±)"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
            </div>
            <div>
              <input
                type="email"
                id="signup-email"
                required
                placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
            </div>
            <div class="password-container">
              <input
                type="password"
                id="signup-password"
                required
                placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
              <i
                class="fas fa-eye toggle-password"
                data-target="signup-password"
                onclick="togglePasswordVisibility(this)"
              ></i>
            </div>

            <button
              type="submit"
              id="signup-submit-btn"
              class="w-full py-3 gold-bg text-gray-900 font-bold rounded-lg gold-shadow hover:bg-yellow-500 transition"
            >
              ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            </button>
            <p class="text-center text-sm text-gray-400 mt-4">
              Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ
              <a
                href="#"
                id="switch-to-login"
                class="gold-color hover:text-yellow-500"
                >ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a
              >
            </p>
          </form>
        </div>
      </div>

      <header
        class="sticky top-0 z-50 p-4 bg-gray-900/90 backdrop-blur-sm shadow-xl border-b border-yellow-800/50"
      >
        <div
          class="max-w-7xl mx-auto flex justify-between items-center flex-wrap"
        >
          <div class="flex items-center space-x-3 space-x-reverse mb-2 md:mb-0">
            <i class="fas fa-pyramid w-10 h-10 gold-color text-4xl"></i>
            <img src="images/logo.png" alt="imge" class="w-[140px] h-[120px]" />
            <h1
              class="text-xl md:text-2xl gold-color font-extrabold tracking-wider ml-5"
            >
              Ø¹Ø§Ø´Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
            </h1>
          </div>

          <button
            id="mobile-menu-button"
            class="md:hidden gold-color text-2xl p-2 rounded-full hover:bg-gray-800 transition focus:outline-none"
          >
            <i class="fas fa-bars"></i>
          </button>

          <nav
            id="main-nav-links"
            class="hidden md:flex flex-col md:flex-row items-center space-x-6 space-x-reverse font-medium w-full md:w-auto mt-4 md:mt-0"
          >
            <a
              href="#"
              id="nav-live-session"
              class="text-white hover:gold-color transition block md:inline-block w-full md:w-auto p-2 md:p-0 hidden"
            >
              <i class="fas fa-video nav-icon gold-color animate-pulse"></i>
              Ù…Ø¨Ø§Ø´Ø±
            </a>

            <a
              href="#lessons-section"
              class="text-white hover:gold-color transition block md:inline-block w-full md:w-auto p-2 md:p-0"
              ><i class="fas fa-book-open nav-icon gold-color"></i> Ø§Ù„Ø¯Ø±ÙˆØ³</a
            >
            <a
              href="#characters-section"
              id="nav-characters"
              class="text-white hover:gold-color transition block md:inline-block w-full md:w-auto p-2 md:p-0"
              ><i class="fas fa-user-friends nav-icon gold-color"></i>
              Ø§Ù„Ø´Ø®ØµÙŠØ§Øª</a
            >
            <a
              href="#quizzes-section"
              id="nav-quizzes"
              class="text-white hover:gold-color transition block md:inline-block w-full md:w-auto p-2 md:p-0"
              ><i class="fas fa-clipboard-list nav-icon gold-color"></i>
              Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</a
            >

            <button
              id="admin-toggle-btn"
              class="py-1 px-3 rounded-full text-xs font-bold transition duration-300 gold-shadow hidden mt-2 md:mt-0"
              style="background-color: #1a1a1a; border: 1px solid #d4af37"
            >
              (Admin Mode)
            </button>

            <button
              id="auth-button"
              class="gold-color text-xl p-2 rounded-full hover:bg-gray-800 transition mt-2 md:mt-0"
            >
              <i class="fas fa-sign-in-alt" id="auth-icon"></i>
            </button>
          </nav>
        </div>
      </header>

      <main>
        <section
          id="hero"
          class="hero-bg py-24 md:py-32 text-center border-b border-yellow-700/50 gold-shadow"
        >
          <div class="max-w-4xl mx-auto px-6">
            <p
              class="text-4xl md:text-6xl font-black mb-6 leading-tight gold-color"
            >
              ØªØ¹Ù„Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® ... Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªØ­ÙŠÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ
            </p>
            <p
              id="access-status"
              class="text-lg text-gray-400 font-medium mb-10 hidden"
            >
              <i class="fas fa-lock ml-2"></i> ÙŠÙØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù†ØªØ¸Ø§Ø±
              Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.
            </p>
            <a
              href="#lessons-section"
              class="inline-block py-4 px-10 rounded-full gold-bg text-gray-900 font-bold text-lg gold-shadow hover:bg-yellow-500 transition transform hover:scale-105 duration-300 ease-in-out"
            >
              Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù† <i class="fas fa-long-arrow-alt-left mr-2"></i>
            </a>
          </div>
        </section>

        <!-- ****** Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡) ****** -->
        <section
          id="admin-live-session-section"
          class="hidden max-w-7xl mx-auto my-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-broadcast-tower gold-color ml-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø±Ø§Ø¨Ø·
            Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
          </h2>
          <form id="live-session-form" class="space-y-4">
            <div>
              <label
                for="live-session-url"
                class="block text-sm font-medium gold-color mb-1"
                >Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Meet Ø£Ùˆ Zoom)</label
              >
              <input
                type="url"
                id="live-session-url"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="https://meet.google.com/abc-xyz-123"
              />
            </div>
            <div>
              <label
                for="live-session-desc"
                class="block text-sm font-medium gold-color mb-1"
                >ÙˆØµÙ Ø§Ù„Ø¬Ù„Ø³Ø©</label
              >
              <input
                type="text"
                id="live-session-desc"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù…Ø«Ø§Ù„: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©ØŒ Ø§Ù„ÙŠÙˆÙ…: Ø§Ù„Ø®Ù…ÙŠØ³ 7 Ù…Ø³Ø§Ø¡Ù‹"
              />
            </div>
            <button
              type="submit"
              id="update-live-session-btn"
              class="w-full py-3 px-4 rounded-lg bg-green-700 text-white font-bold hover:bg-green-600 transition gold-shadow"
            >
              Ø­ÙØ¸ / ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
            </button>
          </form>
          <div
            id="live-session-status-message"
            class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow"
          ></div>
        </section>

        <section
          id="admin-users-approval"
          class="hidden max-w-7xl mx-auto my-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-users-cog gold-color ml-2"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±
          </h2>

          <div class="mb-4">
            <input
              type="text"
              id="user-search-input"
              placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
              class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
            />
          </div>

          <div id="pending-users-list" class="space-y-4">
            <p class="text-gray-500" id="users-loading-status">
              Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...
            </p>
          </div>
        </section>

        <!-- ****** Ù‚Ø³Ù… Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ****** -->
        <section
          id="admin-score-entry-section"
          class="hidden max-w-7xl mx-auto my-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-calculator gold-color ml-2"></i> Ø±ØµØ¯ Ø¯Ø±Ø¬Ø§Øª
            Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
          </h2>
          <form id="score-entry-form" class="space-y-4">
            <div>
              <label
                for="score-student-uid"
                class="block text-sm font-medium gold-color mb-1"
              >
                Ø§Ø³Ù…/Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù„Ù„Ø¨Ø­Ø«)
              </label>
              <input
                type="text"
                id="score-student-search"
                placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø¨Ø±ÙŠØ¯Ù‡ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
              <select
                id="score-student-select"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white mt-2"
                required
              >
                <option value="">-- Ø­Ø¯Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨ --</option>
              </select>
            </div>

            <div>
              <label
                for="score-quiz-select"
                class="block text-sm font-medium gold-color mb-1"
              >
                Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
              </label>
              <select
                id="score-quiz-select"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white"
                required
              >
                <option value="">-- Ø­Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± --</option>
              </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label
                  for="score-value"
                  class="block text-sm font-medium gold-color mb-1"
                >
                  Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø­Ù‚Ù‚Ø©
                </label>
                <input
                  type="number"
                  id="score-value"
                  required
                  min="0"
                  placeholder="Ø¯Ø±Ø¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨"
                  class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                />
              </div>
              <div>
                <label class="block text-sm font-medium gold-color mb-1">
                  Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© (ØªÙ„Ù‚Ø§Ø¦ÙŠ)
                </label>
                <input
                  type="number"
                  id="score-max-display"
                  readonly
                  class="w-full p-3 rounded-lg bg-gray-700 border gold-border text-white placeholder-gray-500"
                />
              </div>
            </div>

            <div>
              <label
                for="score-notes"
                class="block text-sm font-medium gold-color mb-1"
              >
                Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
              </label>
              <textarea
                id="score-notes"
                rows="2"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨"
              ></textarea>
            </div>

            <button
              type="submit"
              id="submit-score-btn"
              class="w-full py-3 px-4 rounded-lg gold-bg text-gray-900 font-bold hover:bg-yellow-500 transition gold-shadow disabled:opacity-50"
            >
              ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø© Ù„Ù„Ø·Ø§Ù„Ø¨
            </button>
          </form>
          <div
            id="score-status-message"
            class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow"
          ></div>
        </section>
        <!-- ****** Ù†Ù‡Ø§ÙŠØ© Ù‚Ø³Ù… Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ****** -->

        <section
          id="add-lesson-section"
          class="hidden max-w-7xl mx-auto mb-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-cogs gold-color ml-2"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±: Ø¥Ø¶Ø§ÙØ©
            Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯
          </h2>
          <form id="add-lesson-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label
                  for="lesson-title"
                  class="block text-sm font-medium gold-color mb-1"
                  >Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label
                >
                <input
                  type="text"
                  id="lesson-title"
                  required
                  class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                  placeholder="Ù…Ø«Ø§Ù„: Ø¹ØµØ± Ø§Ù„Ø£Ø³Ø±Ø§Øª"
                />
              </div>
              <div>
                <label
                  for="lesson-pdf-url"
                  class="block text-sm font-medium gold-color mb-1"
                  >Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label
                >
                <input
                  type="url"
                  id="lesson-pdf-url"
                  class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                  placeholder="https://example.com/document.pdf"
                />
              </div>
            </div>
            <div>
              <label
                for="lesson-summary"
                class="block text-sm font-medium gold-color mb-1"
                >Ù…Ù„Ø®Øµ Ù‚ØµÙŠØ±</label
              >
              <textarea
                id="lesson-summary"
                rows="3"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="ÙˆØµÙ Ù…ÙˆØ¬Ø²"
              ></textarea>
            </div>
            <div>
              <label
                for="lesson-video-url"
                class="block text-sm font-medium gold-color mb-1"
                >Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label
              >
              <input
                type="url"
                id="lesson-video-url"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="https://example.com/video.mp4"
              />
            </div>
            <button
              type="submit"
              id="add-lesson-btn"
              class="w-full py-3 px-4 rounded-lg gold-bg text-gray-900 font-bold hover:bg-yellow-500 transition gold-shadow disabled:opacity-50"
            >
              Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            </button>
          </form>
          <div
            id="lesson-status-message"
            class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow"
          ></div>
        </section>

        <section
          id="add-character-section"
          class="hidden max-w-7xl mx-auto mb-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-mask gold-color ml-2"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±: Ø¥Ø¶Ø§ÙØ©
            Ø´Ø®ØµÙŠØ© ØªØ§Ø±ÙŠØ®ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
          </h2>
          <form id="add-character-form" class="space-y-4">
            <div>
              <label
                for="char-name"
                class="block text-sm font-medium gold-color mb-1"
                >Ø§Ø³Ù… Ø§Ù„Ø´Ø®ØµÙŠØ©</label
              >
              <input
                type="text"
                id="char-name"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ù„Ùƒ Ø£Ø­Ù…Ø³ Ø§Ù„Ø£ÙˆÙ„"
              />
            </div>
            <div>
              <label
                for="char-era"
                class="block text-sm font-medium gold-color mb-1"
                >Ø§Ù„Ø¹ØµØ±/Ø§Ù„Ø­Ù‚Ø¨Ø©</label
              >
              <input
                type="text"
                id="char-era"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©ØŒ Ø¹ØµØ± Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ø«Ø§Ù…Ù†Ø© Ø¹Ø´Ø±Ø©"
              />
            </div>
            <div>
              <label
                for="char-bio"
                class="block text-sm font-medium gold-color mb-1"
                >Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</label
              >
              <textarea
                id="char-bio"
                rows="4"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ø£Ù‡Ù… Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙ‡ ÙˆÙ…ÙƒØ§Ù†ØªÙ‡ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©"
              ></textarea>
            </div>
            <button
              type="submit"
              id="add-character-btn"
              class="w-full py-3 px-4 rounded-lg gold-bg text-gray-900 font-bold hover:bg-yellow-500 transition gold-shadow disabled:opacity-50"
            >
              Ù†Ø´Ø± Ø§Ù„Ø´Ø®ØµÙŠØ©
            </button>
          </form>
          <div
            id="char-status-message"
            class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow"
          ></div>
        </section>

        <section
          id="add-quiz-section"
          class="hidden max-w-7xl mx-auto mb-12 p-6 md:p-12 bg-gray-900/80 rounded-xl border gold-border gold-shadow"
        >
          <h2
            class="text-2xl font-bold mb-6 text-white border-b pb-2 gold-border flex items-center"
          >
            <i class="fas fa-pencil-alt gold-color ml-2"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±:
            Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯
          </h2>
          <form id="add-quiz-form" class="space-y-4">
            <div>
              <label
                for="quiz-title"
                class="block text-sm font-medium gold-color mb-1"
                >Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label
              >
              <input
                type="text"
                id="quiz-title"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¹ØµØ± Ø§Ù„ÙØ±Ø¹ÙˆÙ†ÙŠ"
              />
            </div>
            <div>
              <label
                for="quiz-google-form-url"
                class="block text-sm font-medium gold-color mb-1"
                >Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Google Form (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</label
              >
              <input
                type="url"
                id="quiz-google-form-url"
                required
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="https://docs.google.com/forms/d/e/1FAIpQL.../viewform"
              />
            </div>
            <div>
              <label
                for="quiz-max-score"
                class="block text-sm font-medium gold-color mb-1"
                >Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</label
              >
              <input
                type="number"
                id="quiz-max-score"
                required
                min="1"
                value="10"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
              />
            </div>
            <div>
              <label
                for="quiz-description"
                class="block text-sm font-medium gold-color mb-1"
                >ÙˆØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (ØªØ¹Ù„ÙŠÙ…Ø§Øª)</label
              >
              <textarea
                id="quiz-description"
                rows="2"
                class="w-full p-3 rounded-lg bg-gray-800 border gold-border text-white placeholder-gray-500"
                placeholder="Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠÙ‚ÙŠØ³ Ù…Ø¯Ù‰ ÙÙ‡Ù…Ùƒ Ù„Ù…ÙØ§Ù‡ÙŠÙ…..."
              ></textarea>
            </div>
            <button
              type="submit"
              id="add-quiz-btn"
              class="w-full py-3 px-4 rounded-lg gold-bg text-gray-900 font-bold hover:bg-yellow-500 transition gold-shadow disabled:opacity-50"
            >
              Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            </button>
          </form>
          <div
            id="quiz-status-message"
            class="mt-4 p-3 rounded-lg hidden text-sm text-center font-medium gold-shadow"
          ></div>
        </section>

        <section id="lessons-section" class="max-w-7xl mx-auto p-6 md:p-12">
          <h2
            class="text-2xl font-bold mb-8 text-white border-b pb-2 gold-border"
          >
            Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØªØ§Ø­Ø©
          </h2>
          <p id="lessons-loading-status" class="text-center text-gray-500 my-8">
            ... ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®
          </p>
          <div
            id="lessons-list"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
          ></div>
        </section>

        <section id="characters-section" class="max-w-7xl mx-auto p-6 md:p-12">
          <h2
            class="text-2xl font-bold mb-8 text-white border-b pb-2 gold-border"
          >
            Ø´Ø®ØµÙŠØ§Øª ØªØ§Ø±ÙŠØ®ÙŠØ© Ø¨Ø§Ø±Ø²Ø©
          </h2>
          <p
            id="characters-loading-status"
            class="text-center text-gray-500 my-8"
          >
            ... ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©
          </p>
          <div
            id="characters-list"
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"
          ></div>
        </section>

        <section id="quizzes-section" class="max-w-7xl mx-auto p-6 md:p-12">
          <h2
            id="quizzes-title"
            class="text-2xl font-bold mb-8 text-white border-b pb-2 gold-border"
          >
            Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬
          </h2>
          <p id="quizzes-loading-status" class="text-center text-gray-500 my-8">
            ... ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬
          </p>
          <div
            id="quizzes-list"
            class="grid grid-cols-1 md:grid-cols-2 gap-6"
          ></div>
          <div id="quiz-admin-all-results" class="hidden mt-8"></div>
        </section>
      </main>
    </div>

    <script type="module">
      // ** ğŸ›‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ù…ÙØ·Ø¨Ù‚Ø©) ğŸ›‘ **
      const firebaseConfig = {
        apiKey: "AIzaSyAt9RuqyoOUkbDW8465aEXA8qzC413XSDw",
        authDomain: "history-notes-a88e0.firebaseapp.com",
        projectId: "history-notes-a88e0",
        storageBucket: "history-notes-a88e0.firebasestorage.app",
        messagingSenderId: "946649985119",
        appId: "1:946649985119:web:03630ee34ca1d31f752bea",
        measurementId: "G-C528QQV2HS",
      };

      // Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ¸Ø§Ø¦Ù Firebase Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
        updateProfile, // ğŸ‘ˆ Ù…ÙØ¶Ø§ÙØ© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        collection,
        onSnapshot,
        updateDoc,
        addDoc,
        deleteDoc,
        query,
        where,
        limit,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";

      // ØªÙ‡ÙŠØ¦Ø© Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const analytics = getAnalytics(app);
      const appId = firebaseConfig.appId;

      // **********************************************
      // ************ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ************
      // **********************************************
      const authModal = document.getElementById("auth-modal");
      const authTitle = document.getElementById("auth-title");
      const loginForm = document.getElementById("login-form");
      const signupForm = document.getElementById("signup-form");
      const signupSubmitBtn = document.getElementById("signup-submit-btn");
      const authButton = document.getElementById("auth-button");
      const authMessageBox = document.getElementById("auth-message-box");
      const authIcon = document.getElementById("auth-icon");
      const heroSection = document.getElementById("hero");
      const accessStatus = document.getElementById("access-status");
      const adminToggleBtn = document.getElementById("admin-toggle-btn");

      const LIVE_SESSION_DOC_ID = "current_session";

      // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±
      const adminUsersApprovalSection = document.getElementById(
        "admin-users-approval"
      );
      const addLessonSection = document.getElementById("add-lesson-section");
      const addCharacterSection = document.getElementById(
        "add-character-section"
      );
      const addQuizSection = document.getElementById("add-quiz-section");
      // ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ù‡Ù†Ø§
      const adminScoreEntrySection = document.getElementById(
        "admin-score-entry-section"
      );

      const liveSessionForm = document.getElementById("live-session-form");
      const liveSessionStatusMessageEl = document.getElementById(
        "live-session-status-message"
      );
      const lessonStatusMessageEl = document.getElementById(
        "lesson-status-message"
      );
      const charStatusMessageEl = document.getElementById(
        "char-status-message"
      );
      const quizStatusMessageEl = document.getElementById(
        "quiz-status-message"
      );
      const userSearchInput = document.getElementById("user-search-input");
      const pendingUsersList = document.getElementById("pending-users-list");
      const addLessonBtn = document.getElementById("add-lesson-btn");
      const addCharacterBtn = document.getElementById("add-character-btn");
      const addQuizBtn = document.getElementById("add-quiz-btn");
      const currentUserInfoEl = document.getElementById("access-status");

      // Ø¹Ù†Ø§ØµØ± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
      const lessonsListEl = document.getElementById("lessons-list");
      const charactersListEl = document.getElementById("characters-list");
      const quizzesListEl = document.getElementById("quizzes-list");
      const navLiveSession = document.getElementById("nav-live-session");

      // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      let userId = null;
      let userData = null;
      let isAuthReady = false;
      let isUserAdmin = false;
      let isAdminMode = false;
      let unsubscribeUsers = null;
      let studentsProfiles = [];
      let allQuizzes = []; // Ù„Ø­ÙØ¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª

      // **********************************************
      // ************ ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù€ UI ************
      // **********************************************

      function showMessage(element, message, isError = false) {
        if (!element) return;
        element.textContent = message;
        element.classList.remove("hidden", "text-yellow-300", "text-red-400");
        element.classList.add(isError ? "text-red-400" : "text-yellow-300");
        element.classList.remove("hidden");
        setTimeout(() => {
          element.classList.add("hidden");
        }, 5000);
      }

      window.closeAuthModal = function () {
        authModal.classList.add("opacity-0", "pointer-events-none");
        authModal.classList.remove("opacity-100");
        showMessage(authMessageBox, "", false);
      };

      function openAuthModal() {
        authTitle.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
        loginForm.classList.remove("hidden");
        signupForm.classList.add("hidden");

        authModal.classList.remove(
          "opacity-0",
          "pointer-events-none",
          "hidden"
        );
        authModal.classList.add("opacity-100");
        showMessage(authMessageBox, "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.", false);
      }

      window.togglePasswordVisibility = function (iconElement) {
        const targetId = iconElement.getAttribute("data-target");
        const passwordInput = document.getElementById(targetId);
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          iconElement.classList.remove("fa-eye");
          iconElement.classList.add("fa-eye-slash");
        } else {
          passwordInput.type = "password";
          iconElement.classList.remove("fa-eye-slash");
          iconElement.classList.add("fa-eye");
        }
      };

      // **********************************************
      // ************ Ù…Ù†Ø·Ù‚ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ************
      // **********************************************

      document
        .getElementById("switch-to-signup")
        .addEventListener("click", (e) => {
          e.preventDefault();
          authTitle.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
          loginForm.classList.add("hidden");
          signupForm.classList.remove("hidden");
          showMessage(authMessageBox, "", false);
        });

      document
        .getElementById("switch-to-login")
        .addEventListener("click", (e) => {
          e.preventDefault();
          authTitle.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
          signupForm.classList.add("hidden");
          loginForm.classList.remove("hidden");
          showMessage(authMessageBox, "", false);
        });

      // ****************************************************
      // ************ Ù…Ù†Ø·Ù‚ Firebase Authentication ************
      // ****************************************************

      // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;
        showMessage(authMessageBox, "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...", false);

        try {
          await signInWithEmailAndPassword(auth, email, password);
          // onAuthStateChanged Ø³ÙŠØªÙˆÙ„Ù‰ Ø§Ù„Ø¨Ø§Ù‚ÙŠ (Ø¬Ù„Ø¨/Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ)
        } catch (error) {
          let errorMessage =
            "Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.";
          if (
            error.code === "auth/wrong-password" ||
            error.code === "auth/user-not-found"
          ) {
            errorMessage = "Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.";
          } else if (error.code === "auth/network-request-failed") {
            errorMessage = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ.";
          }
          showMessage(authMessageBox, errorMessage, true);
        }
      });

      // 2. ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
      signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("signup-name").value.trim();
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;

        if (password.length < 6) {
          showMessage(
            authMessageBox,
            "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.",
            true
          );
          return;
        }

        // ØªØ­Ø¯ÙŠØ¯ Ø¯ÙˆØ± ÙˆÙ…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§
        const is_admin_match = name === "admin" && email === "admin@gmail.com";
        const userRole = is_admin_match ? "admin" : "student";
        const isApprovedStatus = is_admin_match;

        signupSubmitBtn.disabled = true;
        showMessage(authMessageBox, "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...", false);

        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            email,
            password
          );
          const user = userCredential.user;

          // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶
          if (user.displayName !== name) {
            await updateProfile(user, { displayName: name });
          }

          // Ø­ÙØ¸ Ù…Ù„Ù ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore
          await setDoc(doc(db, "artifacts", appId, "user_profiles", user.uid), {
            uid: user.uid,
            name: name,
            email: email,
            role: userRole,
            isApproved: isApprovedStatus,
            createdAt: new Date().toISOString(),
          });

          if (!isApprovedStatus) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·Ø§Ù„Ø¨Ø§Ù‹ØŒ Ù†Ø³Ø¬Ù„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù„Ø¥Ø¬Ø¨Ø§Ø±Ù‡ Ø¹Ù„Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
            await signOut(auth);
            showMessage(
              authMessageBox,
              "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ù„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.",
              false
            );
            document.getElementById("switch-to-login").click();
          } else {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¯ÙŠØ±Ø§Ù‹ØŒ ÙŠØ¸Ù„ Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ùˆ onAuthStateChanged Ø³ÙŠØªÙˆÙ„Ù‰ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
            // Ù„Ø§ Ù†ØºÙ„Ù‚ Ø§Ù„Ù€ modal Ù‡Ù†Ø§ØŒ Ù†ØªØ±ÙƒÙ‡ Ù„Ù€ onAuthStateChanged
          }
        } catch (error) {
          let errorMessage = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.";
          if (error.code === "auth/email-already-in-use") {
            errorMessage = "Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.";
          } else if (error.code === "auth/weak-password") {
            errorMessage =
              "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).";
          } else {
            errorMessage = `âŒ ÙØ´Ù„ Ø­Ø±Ø¬ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${
              error.message
            }. (ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£: ${
              error.code || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"
            }). ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØªØ§Ø­ Ø§Ù„Ù€ API.`;
          }
          showMessage(authMessageBox, errorMessage, true);
        } finally {
          signupSubmitBtn.disabled = false;
        }
      });

      // 3. Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨
      function handleLogout() {
        signOut(auth).catch((error) => {
          console.error("Logout Error:", error);
        });
      }

      // **********************************************
      // ************ Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù€ UI ************
      // **********************************************

      function toggleAdminUI(show) {
        // Ø­Ù…Ø§ÙŠØ©: ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§
        const adminSections = [
          adminUsersApprovalSection,
          addLessonSection,
          addCharacterSection,
          addQuizSection,
          adminScoreEntrySection, // Ø£Ø¶ÙŠÙ Ù‚Ø³Ù… Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ù‡Ù†Ø§
          document.getElementById("admin-live-session-section"), // Ø£Ø¶ÙŠÙ Ù‚Ø³Ù… Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù‡Ù†Ø§
        ];

        adminSections.forEach((section) => {
          if (section) {
            section.classList.toggle("hidden", !show);
          }
        });

        if (show) {
          loadAllUsers();
          // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù„Ù†Ù…ÙˆØ°Ø¬ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
          loadStudentsForScoreEntry();
        } else if (unsubscribeUsers) {
          unsubscribeUsers();
          unsubscribeUsers = null;
        }
      }

      // 4. Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ø§Ù„ØªÙŠ ØªÙØ­Ø¯Ù‘Ø« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ù…ÙØ¹Ø¯Ù„Ø©)
      onAuthStateChanged(auth, async (user) => {
        isAuthReady = true;
        userId = user ? user.uid : null;
        userData = null;

        if (user) {
          // 1. ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„Ø®Ø±ÙˆØ¬
          authIcon.classList.remove("fa-sign-in-alt");
          authIcon.classList.add("fa-sign-out-alt");
          authButton.onclick = handleLogout;

          // 2. Ø¬Ù„Ø¨ Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
          const userDocRef = doc(
            db,
            "artifacts",
            appId,
            "user_profiles",
            user.uid
          );

          try {
            const userDoc = await getDoc(userDocRef);

            let profileData = null;
            if (userDoc.exists()) {
              profileData = userDoc.data();
            } else {
              // *** Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡ ÙƒØ·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ***
              console.log(
                "User profile missing in Firestore. Creating default profile (Pending Student)."
              );
              const defaultProfile = {
                uid: user.uid,
                name: user.displayName || "Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯",
                email: user.email,
                role: "student",
                isApproved: false,
                createdAt: new Date().toISOString(),
              };
              await setDoc(userDocRef, defaultProfile);
              profileData = defaultProfile; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø­Ø¯ÙŠØ«Ø§Ù‹
            }

            // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ± (Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ø§Ø³Ù… Ø­ØªÙ‰ Ù„Ùˆ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù ÙŠØ¯ÙˆÙŠØ§Ù‹)
            // Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… admin@gmail.com ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙˆØ±Ø§Ù‹
            if (profileData.email === "admin@gmail.com") {
              if (
                profileData.role !== "admin" ||
                profileData.isApproved !== true
              ) {
                await updateDoc(userDocRef, {
                  role: "admin",
                  isApproved: true,
                });
                profileData.role = "admin";
                profileData.isApproved = true;
              }
            }

            userData = profileData;

            const role = userData.role || "pending";
            const isApproved = userData.isApproved === true;

            isUserAdmin = role === "admin" && isApproved;

            // 4. ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±
            if (isApproved) {
              closeAuthModal();
              heroSection.classList.remove("opacity-50");
              accessStatus.classList.add("hidden");

              adminToggleBtn.classList.toggle("hidden", !isUserAdmin);
              adminToggleBtn.textContent = isAdminMode
                ? "(User View)"
                : "(Admin Mode)";
              toggleAdminUI(isAdminMode && isUserAdmin);

              loadLessons();
              loadCharacters();
              loadQuizzesAndResults();
              loadLiveSession();
            } else {
              // Ø¯ÙˆØ± pending (Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±)
              heroSection.classList.add("opacity-50");
              accessStatus.classList.remove("hidden");
              accessStatus.textContent = `âš ï¸ Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. ÙŠÙØ±Ø¬Ù‰ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.`;
              adminToggleBtn.classList.add("hidden");
              toggleAdminUI(false);
              navLiveSession.classList.add("hidden");
            }
          } catch (error) {
            // Ø®Ø·Ø£ ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            console.error("Error fetching or creating user profile:", error);
            showMessage(
              currentUserInfoEl,
              `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ. ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firestore: ${error.message}`,
              true
            );
          }
        } else {
          // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
          isUserAdmin = false;
          isAdminMode = false;
          userData = null;

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ UI
          authIcon.classList.remove("fa-sign-out-alt");
          authIcon.classList.add("fa-sign-in-alt");
          authButton.onclick = openAuthModal;

          heroSection.classList.add("opacity-50");
          accessStatus.classList.remove("hidden");
          accessStatus.textContent = `ğŸ”’ ÙŠÙØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.`;
          adminToggleBtn.classList.add("hidden");
          toggleAdminUI(false);
          navLiveSession.classList.add("hidden");

          lessonsListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰. ÙŠÙØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>`;
          charactersListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰. ÙŠÙØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>`;
          quizzesListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰. ÙŠÙØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>`;
        }
      });

      // 5. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      adminToggleBtn.addEventListener("click", () => {
        if (isUserAdmin) {
          isAdminMode = !isAdminMode;
          adminToggleBtn.textContent = isAdminMode
            ? "(User View)"
            : "(Admin Mode)";
          toggleAdminUI(isAdminMode);
          loadLessons();
          loadCharacters();
          loadQuizzesAndResults();
        }
      });

      // **********************************************
      // ************ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ ************
      // **********************************************

      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mainNavLinks = document.getElementById("main-nav-links");

      if (mobileMenuButton && mainNavLinks) {
        mobileMenuButton.addEventListener("click", () => {
          mainNavLinks.classList.toggle("hidden");
          const icon = mobileMenuButton.querySelector("i");
          if (mainNavLinks.classList.contains("hidden")) {
            icon.classList.remove("fa-times");
            icon.classList.add("fa-bars");
          } else {
            icon.classList.remove("fa-bars");
            icon.classList.add("fa-times");
          }
        });

        mainNavLinks.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", () => {
            if (!mainNavLinks.classList.contains("hidden")) {
              mobileMenuButton.click();
            }
          });
        });
      }

      // **********************************************
      // ************ ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ ************
      // **********************************************

      // **************** Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³ ****************
      function loadLessons() {
        if (!db || !isAuthReady || userData?.isApproved !== true) return;

        const lessonsRef = collection(
          db,
          "artifacts",
          appId,
          "public",
          "data",
          "history_lessons"
        );
        const lessonsQuery = query(lessonsRef, limit(50));

        onSnapshot(
          lessonsQuery,
          (snapshot) => {
            lessonsListEl.innerHTML = "";
            document
              .getElementById("lessons-loading-status")
              .classList.add("hidden");

            if (snapshot.empty) {
              lessonsListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
              return;
            }

            snapshot.forEach((doc) => {
              renderLesson(doc.id, doc.data());
            });
          },
          (error) => {
            console.error("Error listening to Firestore lessons:", error);
            document.getElementById("lessons-loading-status").textContent =
              "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³.";
          }
        );
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø±Ø³ ****************
      function renderLesson(docId, data) {
        const card = document.createElement("div");
        card.className =
          "lesson-card p-6 bg-gray-900 rounded-xl gold-shadow flex flex-col justify-between";
        card.dataset.docId = docId;

        let mediaLinks = "";
        if (data.pdfUrl) {
          mediaLinks += `<a href="${data.pdfUrl}" target="_blank" class="text-sm gold-color hover:text-yellow-500 transition ml-4"><i class="fas fa-file-pdf ml-1"></i> Ù‚Ø±Ø§Ø¡Ø© PDF</a>`;
        }
        if (data.videoUrl) {
          mediaLinks += `<a href="${data.videoUrl}" target="_blank" class="text-sm gold-color hover:text-yellow-500 transition"><i class="fas fa-video ml-1"></i> Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙŠØ¯ÙŠÙˆ</a>`;
        }

        const showDeleteButton = isAdminMode && isUserAdmin;

        const content = `
              <div>
                  <span class="text-xs text-gray-500 mb-1 block">Ù„Ù„ØµÙ: Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</span>
                  <h3 class="text-xl font-bold gold-color mb-2">${
                    data.title || "Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"
                  }</h3>
                  <p class="text-sm text-gray-400 mb-4">${
                    data.summary || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø®Øµ."
                  }</p>
              </div>
              <div class="flex justify-between items-center pt-3 border-t border-gray-700/50 mt-4">
                  <div class="flex items-center space-x-4 space-x-reverse">${mediaLinks}</div>
                  ${
                    showDeleteButton
                      ? `<button data-doc-id="${docId}" data-type="lesson" class="py-1 px-3 rounded-md delete-btn text-white text-sm transition">Ø­Ø°Ù</button>`
                      : `<span class="text-xs text-gray-500">Ù…Ù†Ø´ÙˆØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</span>`
                  }
              </div>
          `;
        card.innerHTML = content;
        lessonsListEl.appendChild(card);

        if (showDeleteButton) {
          card
            .querySelector(".delete-btn")
            ?.addEventListener("click", handleDelete);
        }
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ (Ù…ÙØ¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬) ****************
      document
        .getElementById("add-lesson-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          if (!isUserAdmin || !isAdminMode) {
            showMessage(
              lessonStatusMessageEl,
              "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø§Ù„Ø¥Ø¶Ø§ÙØ©.",
              true
            );
            return;
          }

          const title = document.getElementById("lesson-title").value;
          const summary = document.getElementById("lesson-summary").value;
          const pdfUrl = document.getElementById("lesson-pdf-url").value;
          const videoUrl = document.getElementById("lesson-video-url").value;

          addLessonBtn.disabled = true;
          showMessage(lessonStatusMessageEl, "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø³...", false);

          try {
            const lessonsRef = collection(
              db,
              "artifacts",
              appId,
              "public",
              "data",
              "history_lessons"
            );
            await addDoc(lessonsRef, {
              title: title,
              summary: summary,
              pdfUrl: pdfUrl,
              videoUrl: videoUrl,
              authorId: userId,
              createdAt: new Date().toISOString(),
            });

            showMessage(
              lessonStatusMessageEl,
              "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­!",
              false
            );
            document.getElementById("add-lesson-form").reset();
          } catch (e) {
            console.error("Error adding document: ", e);
            showMessage(
              lessonStatusMessageEl,
              `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${e.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.`,
              true
            );
          } finally {
            addLessonBtn.disabled = false;
          }
        });

      // **************** Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© ****************
      function loadCharacters() {
        if (!db || !isAuthReady || userData?.isApproved !== true) return;

        const charsRef = collection(
          db,
          "artifacts",
          appId,
          "public",
          "data",
          "historical_characters"
        );
        const charsQuery = query(charsRef, limit(50));

        onSnapshot(
          charsQuery,
          (snapshot) => {
            charactersListEl.innerHTML = "";
            document
              .getElementById("characters-loading-status")
              .classList.add("hidden");

            if (snapshot.empty) {
              charactersListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø®ØµÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
              return;
            }

            snapshot.forEach((doc) => {
              renderCharacter(doc.id, doc.data());
            });
          },
          (error) => {
            console.error("Error listening to Firestore characters:", error);
            document.getElementById("characters-loading-status").textContent =
              "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª.";
          }
        );
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© ****************
      function renderCharacter(docId, data) {
        const card = document.createElement("div");
        card.className =
          "char-card p-4 bg-gray-900 rounded-xl gold-shadow flex flex-col justify-between items-start";
        card.dataset.docId = docId;

        const showDeleteButton = isAdminMode && isUserAdmin;

        const content = `
              <i class="fas fa-crown gold-color text-2xl mb-2"></i>
              <h3 class="text-lg font-bold text-white mb-1">${
                data.name || "Ø´Ø®ØµÙŠØ© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©"
              }</h3>
              <p class="text-sm gold-color mb-2">${
                data.era || "Ø­Ù‚Ø¨Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©"
              }</p>
              <p class="text-xs text-gray-400 mb-4 line-clamp-4">${
                data.bio || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©."
              }</p>

              ${
                showDeleteButton
                  ? `<button data-doc-id="${docId}" data-type="character" class="py-1 px-3 rounded-md delete-btn text-white text-xs transition mt-2 self-end">Ø­Ø°Ù</button>`
                  : ""
              }
          `;
        card.innerHTML = content;
        charactersListEl.appendChild(card);

        if (showDeleteButton) {
          card
            .querySelector(".delete-btn")
            ?.addEventListener("click", handleDelete);
        }
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© (Ù…ÙØ¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬) ****************
      document
        .getElementById("add-character-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          if (!isUserAdmin || !isAdminMode) {
            showMessage(
              charStatusMessageEl,
              "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø§Ù„Ø¥Ø¶Ø§ÙØ©.",
              true
            );
            return;
          }

          const name = document.getElementById("char-name").value;
          const era = document.getElementById("char-era").value;
          const bio = document.getElementById("char-bio").value;

          if (!name || !era || !bio) {
            showMessage(
              charStatusMessageEl,
              "ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø´Ø®ØµÙŠØ©.",
              true
            );
            return;
          }

          addCharacterBtn.disabled = true;
          showMessage(charStatusMessageEl, "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø´Ø®ØµÙŠØ©...", false);

          try {
            const charsRef = collection(
              db,
              "artifacts",
              appId,
              "public",
              "data",
              "historical_characters"
            );

            await addDoc(charsRef, {
              name: name,
              era: era,
              bio: bio,
              authorId: userId,
              createdAt: new Date().toISOString(),
            });

            showMessage(
              charStatusMessageEl,
              "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!",
              false
            );
            document.getElementById("add-character-form").reset();
          } catch (e) {
            console.error("Error adding character: ", e);
            showMessage(
              charStatusMessageEl,
              `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${e.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.`,
              true
            );
          } finally {
            addCharacterBtn.disabled = false;
          }
        });

      // **************** Ø¯Ø§Ù„Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ****************
      const LIVE_SESSION_REF = doc(
        db,
        "artifacts",
        appId,
        "public",
        "data",
        "live_session",
        LIVE_SESSION_DOC_ID
      );

      function loadLiveSession() {
        if (!db || !isAuthReady || userData?.isApproved !== true) {
          navLiveSession.classList.add("hidden");
          return;
        }

        onSnapshot(LIVE_SESSION_REF, (docSnap) => {
          if (docSnap.exists() && docSnap.data().url) {
            const data = docSnap.data();

            navLiveSession.href = data.url;
            navLiveSession.target = "_blank";
            navLiveSession.classList.remove("hidden");
            navLiveSession.title =
              data.description || "Ø§Ø¶ØºØ· Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±!";

            if (isUserAdmin && isAdminMode) {
              document.getElementById("live-session-url").value = data.url;
              document.getElementById("live-session-desc").value =
                data.description || "";
            }
          } else {
            navLiveSession.classList.add("hidden");
          }
        });
      }

      // Ø¯Ø§Ù„Ø© Ø­ÙØ¸/ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)
      liveSessionForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!isUserAdmin || !isAdminMode) {
          showMessage(
            liveSessionStatusMessageEl,
            "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ«.",
            true
          );
          return;
        }

        const url = document.getElementById("live-session-url").value;
        const description = document.getElementById("live-session-desc").value;

        if (!url) {
          showMessage(liveSessionStatusMessageEl, "Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ø²Ø§Ù…ÙŠ.", true);
          return;
        }

        document.getElementById("update-live-session-btn").disabled = true;
        showMessage(
          liveSessionStatusMessageEl,
          "Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø©...",
          false
        );

        try {
          await setDoc(LIVE_SESSION_REF, {
            url: url,
            description: description,
            updatedBy: userId,
            updatedAt: new Date().toISOString(),
          });

          showMessage(
            liveSessionStatusMessageEl,
            "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!",
            false
          );
        } catch (e) {
          console.error("Error updating live session: ", e);
          showMessage(
            liveSessionStatusMessageEl,
            `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${e.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.`,
            true
          );
        } finally {
          document.getElementById("update-live-session-btn").disabled = false;
        }
      });

      // **************** Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ ****************
      function loadQuizzesAndResults() {
        if (!db || !isAuthReady || userData?.isApproved !== true) return;

        document.getElementById("quizzes-title").textContent =
          isUserAdmin && isAdminMode
            ? "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±)"
            : `Ù†ØªØ§Ø¦Ø¬ÙŠ (${userData?.name || "Ø·Ø§Ù„Ø¨"})`;
        document
          .getElementById("quizzes-loading-status")
          .classList.remove("hidden");
        quizzesListEl.innerHTML = "";

        const quizzesRef = collection(
          db,
          "artifacts",
          appId,
          "public",
          "data",
          "quizzes"
        );
        const resultsRef = collection(
          db,
          "artifacts",
          appId,
          "users",
          userId,
          "quiz_results"
        );

        onSnapshot(
          resultsRef,
          (resultsSnapshot) => {
            const resultsMap = {};
            resultsSnapshot.forEach((doc) => {
              resultsMap[doc.id] = doc.data();
            });

            onSnapshot(quizzesRef, (quizSnapshot) => {
              document
                .getElementById("quizzes-loading-status")
                .classList.add("hidden");
              quizzesListEl.innerHTML = "";
              allQuizzes = []; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
              quizSnapshot.forEach((doc) => {
                allQuizzes.push({ id: doc.id, ...doc.data() });
              });

              if (allQuizzes.length === 0) {
                quizzesListEl.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
                return;
              }

              allQuizzes.forEach((quiz) => {
                if (!isUserAdmin || !isAdminMode) {
                  renderStudentResult(quiz, resultsMap[quiz.id]);
                } else {
                  renderQuizCardForAdmin(quiz);
                }
              });

              // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
              updateQuizSelectOptions();
            });
          },
          (error) => {
            console.error("Error loading quiz results/quizzes:", error);
            document.getElementById("quizzes-loading-status").textContent =
              "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª/Ø§Ù„Ù†ØªØ§Ø¦Ø¬.";
          }
        );
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ****************
      function renderStudentResult(quiz, result) {
        const card = document.createElement("div");
        card.className =
          "quiz-card p-6 bg-gray-900 rounded-xl gold-shadow flex flex-col justify-between";

        const scoreText = result
          ? `<span class="text-2xl font-bold gold-color">${result.score} / ${quiz.maxScore}</span>`
          : `<span class="text-sm text-red-500">Ù„Ù… ÙŠØªÙ… Ø±ØµØ¯ Ø¯Ø±Ø¬Ø© Ø¨Ø¹Ø¯.</span>`;

        const content = `
              <div class="flex justify-between items-start mb-2">
                  <h3 class="text-xl font-bold text-white">${quiz.title}</h3>
                  <a href="${
                    quiz.googleFormUrl
                  }" target="_blank" rel="noopener noreferrer"
                     class="live-btn py-2 px-4 rounded-lg text-white font-bold text-sm flex items-center gold-shadow hover:bg-green-600 transition">
                      <i class="fas fa-external-link-alt ml-2"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Google Form)
                  </a>
              </div>
              <p class="text-sm text-gray-400 mb-3">${quiz.description}</p>
              <div class="flex justify-between items-center pt-3 border-t border-gray-700/50 mt-2">
                  <p class="text-sm text-gray-500">Ø¯Ø±Ø¬ØªÙƒ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</p>
                  ${scoreText}
              </div>
              ${
                result?.notes
                  ? `<p class="text-xs text-gray-400 mt-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±: ${result.notes}</p>`
                  : ""
              }
          `;
        card.innerHTML = content;
        quizzesListEl.appendChild(card);
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ù…Ø¯ÙŠØ± ****************
      function renderQuizCardForAdmin(quiz) {
        const card = document.createElement("div");
        card.className =
          "quiz-card p-4 bg-gray-800 rounded-xl gold-border border flex justify-between items-center";

        const content = `
              <div>
                  <h3 class="text-lg font-bold gold-color">${quiz.title}</h3>
                  <p class="text-sm text-gray-400">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©: ${quiz.maxScore}</p>
                  <a href="${quiz.googleFormUrl}" target="_blank" class="text-xs text-blue-400 hover:underline flex items-center">
                      <i class="fas fa-link ml-1"></i> Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                  </a>
              </div>
              <button data-doc-id="${quiz.id}" data-type="quiz" class="py-1 px-3 rounded-md delete-btn text-white text-xs transition">Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
          `;
        card.innerHTML = content;
        quizzesListEl.appendChild(card);

        card
          .querySelector(".delete-btn")
          ?.addEventListener("click", handleDelete);
      }

      // **************** Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯ (Google Form) ****************
      document
        .getElementById("add-quiz-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          if (!isUserAdmin || !isAdminMode) {
            showMessage(
              quizStatusMessageEl,
              "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø§Ù„Ø¥Ø¶Ø§ÙØ©.",
              true
            );
            return;
          }

          const title = document.getElementById("quiz-title").value;
          const googleFormUrl = document.getElementById(
            "quiz-google-form-url"
          ).value;
          const maxScore = parseInt(
            document.getElementById("quiz-max-score").value
          );
          const description = document.getElementById("quiz-description").value;

          if (!title || !googleFormUrl || isNaN(maxScore) || maxScore <= 0) {
            showMessage(
              quizStatusMessageEl,
              "ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ±Ø§Ø¨Ø· Google Form ÙˆØ§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© (Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±).",
              true
            );
            return;
          }

          addQuizBtn.disabled = true;
          showMessage(
            quizStatusMessageEl,
            "Ø¬Ø§Ø±ÙŠ Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Google Form)...",
            false
          );

          try {
            const quizzesRef = collection(
              db,
              "artifacts",
              appId,
              "public",
              "data",
              "quizzes"
            );

            await addDoc(quizzesRef, {
              title: title,
              maxScore: maxScore,
              googleFormUrl: googleFormUrl,
              description: description,
              authorId: userId,
              createdAt: new Date().toISOString(),
            });

            showMessage(
              quizStatusMessageEl,
              `âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ø¢Ù†.`,
              false
            );
            document.getElementById("add-quiz-form").reset();
          } catch (e) {
            console.error("Error adding quiz: ", e);
            showMessage(
              quizStatusMessageEl,
              `âŒ Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${e.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.`,
              true
            );
          } finally {
            addQuizBtn.disabled = false;
          }
        });

      // **************** ÙˆØ¸ÙŠÙØ© Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (Ø¬Ø¯ÙŠØ¯) ****************

      const scoreStatusMessageEl = document.getElementById(
        "score-status-message"
      );
      const scoreStudentSelect = document.getElementById(
        "score-student-select"
      );
      const scoreQuizSelect = document.getElementById("score-quiz-select");
      const scoreMaxDisplay = document.getElementById("score-max-display");

      // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙŠ Ù†Ù…ÙˆØ°Ø¬ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      function updateQuizSelectOptions() {
        scoreQuizSelect.innerHTML =
          '<option value="">-- Ø­Ø¯Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± --</option>';
        allQuizzes.forEach((quiz) => {
          const option = document.createElement("option");
          option.value = quiz.id;
          option.textContent = `${quiz.title} (Ø§Ù„ÙƒÙ„ÙŠØ©: ${quiz.maxScore})`;
          option.dataset.maxScore = quiz.maxScore;
          scoreQuizSelect.appendChild(option);
        });
      }

      // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ù„Ù†Ù…ÙˆØ°Ø¬ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      function loadStudentsForScoreEntry() {
        if (!db || !isAuthReady || !isUserAdmin) return;

        const profilesRef = collection(db, "artifacts", appId, "user_profiles");
        const studentsQuery = query(
          profilesRef,
          where("isApproved", "==", true),
          where("role", "==", "student")
        );

        onSnapshot(
          studentsQuery,
          (snapshot) => {
            scoreStudentSelect.innerHTML =
              '<option value="">-- Ø­Ø¯Ø¯ Ø§Ù„Ø·Ø§Ù„Ø¨ --</option>';
            studentsProfiles = [];

            snapshot.forEach((doc) => {
              const profile = doc.data();
              studentsProfiles.push(profile);
              const option = document.createElement("option");
              option.value = profile.uid;
              option.textContent = `${profile.name} (${profile.email})`;
              scoreStudentSelect.appendChild(option);
            });
          },
          (error) => {
            console.error("Error loading students for scoring:", error);
          }
        );

        // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£ÙŠØ¶Ø§Ù‹
        loadQuizzesAndResults();
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
      scoreQuizSelect.addEventListener("change", () => {
        const selectedOption =
          scoreQuizSelect.options[scoreQuizSelect.selectedIndex];
        if (selectedOption && selectedOption.dataset.maxScore) {
          scoreMaxDisplay.value = selectedOption.dataset.maxScore;
        } else {
          scoreMaxDisplay.value = "";
        }
      });

      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
      document
        .getElementById("score-entry-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          if (!isUserAdmin || !isAdminMode) {
            showMessage(
              scoreStatusMessageEl,
              "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø· Ø±ØµØ¯ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª.",
              true
            );
            return;
          }

          const studentId = scoreStudentSelect.value;
          const quizId = scoreQuizSelect.value;
          const score = parseInt(document.getElementById("score-value").value);
          const notes = document.getElementById("score-notes").value;
          const maxScore = parseInt(scoreMaxDisplay.value);

          if (
            !studentId ||
            !quizId ||
            isNaN(score) ||
            score < 0 ||
            score > maxScore
          ) {
            showMessage(
              scoreStatusMessageEl,
              "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ ÙˆØ§Ø®ØªØ¨Ø§Ø± ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø¯Ø±Ø¬Ø© ØµØ­ÙŠØ­Ø© Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©.",
              true
            );
            return;
          }

          document.getElementById("submit-score-btn").disabled = true;
          showMessage(scoreStatusMessageEl, "Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø©...", false);

          try {
            // Ù…Ø³Ø§Ø± Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
            const resultDocRef = doc(
              db,
              "artifacts",
              appId,
              "users",
              studentId,
              "quiz_results",
              quizId
            );

            await setDoc(resultDocRef, {
              quizId: quizId,
              score: score,
              maxScore: maxScore,
              notes: notes,
              recordedBy: userId,
              recordedAt: new Date().toISOString(),
            });

            showMessage(
              scoreStatusMessageEl,
              `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø© (${score}/${maxScore}) Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!`,
              false
            );
            document.getElementById("score-entry-form").reset();
          } catch (e) {
            console.error("Error recording score: ", e);
            showMessage(
              scoreStatusMessageEl,
              `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø©: ${e.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.`,
              true
            );
          } finally {
            document.getElementById("submit-score-btn").disabled = false;
          }
        });

      // **************** Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù„Ù„Ù…Ø¯ÙŠØ±) ****************
      function loadAllUsers() {
        if (unsubscribeUsers) {
          unsubscribeUsers();
          unsubscribeUsers = null;
        }

        if (!db || !isAuthReady || !isUserAdmin || !isAdminMode) return;

        const profilesRef = collection(db, "artifacts", appId, "user_profiles");
        const usersQuery = query(profilesRef, limit(50));
        const userSearchInput = document.getElementById("user-search-input");
        const searchTerm = userSearchInput?.value?.trim().toLowerCase();

        pendingUsersList.innerHTML = `<p class="text-gray-500" id="users-loading-status">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</p>`;

        unsubscribeUsers = onSnapshot(
          usersQuery,
          (snapshot) => {
            pendingUsersList.innerHTML = "";
            let users = [];

            snapshot.forEach((doc) => {
              const profile = doc.data();

              if (
                profile.uid !== userId &&
                (!searchTerm ||
                  profile.name?.toLowerCase().includes(searchTerm) ||
                  profile.email?.toLowerCase().includes(searchTerm))
              ) {
                users.push(profile);
              }
            });

            if (users.length === 0) {
              pendingUsersList.innerHTML = `<p class="text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚ÙˆÙ† Ø£Ùˆ Ù…Ø¹Ù„Ù‚ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
              return;
            }

            users.forEach((profile) => {
              const userCard = document.createElement("div");
              userCard.className =
                "flex flex-col md:flex-row justify-between items-center p-4 bg-gray-800 rounded-lg gold-border border";

              let statusBadge = profile.isApproved
                ? profile.role === "admin"
                  ? `<span class="text-green-400">Ù…Ø¯ÙŠØ±</span>`
                  : `<span class="text-yellow-400">Ù…ÙÙˆØ§ÙÙÙ‚ Ø¹Ù„ÙŠÙ‡</span>`
                : `<span class="text-red-400">Ù…ÙØ¹ÙÙ„ÙÙ‘Ù‚</span>`;

              let actionButtons = "";
              const uid = profile.uid;

              if (profile.role === "student" && !profile.isApproved) {
                actionButtons = `
                          <button data-uid="${uid}" data-action="approve" class="py-1 px-3 rounded-md bg-green-700 text-white text-sm hover:bg-green-600 transition">Ù…ÙˆØ§ÙÙ‚Ø© (Ø·Ø§Ù„Ø¨)</button>
                          <button data-uid="${uid}" data-action="set-admin" class="py-1 px-3 rounded-md admin-set-btn text-white text-sm hover:bg-yellow-700 transition">ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ø¯ÙŠØ±</button>
                          <button data-uid="${uid}" data-action="reject" class="py-1 px-3 rounded-md delete-btn text-white text-sm hover:bg-red-700 transition">Ø±ÙØ¶/Ø­Ø°Ù</button>
                      `;
              } else if (profile.role === "student" && profile.isApproved) {
                actionButtons = `
                          <button data-uid="${uid}" data-action="set-admin" class="py-1 px-3 rounded-md admin-set-btn text-white text-sm hover:bg-yellow-700 transition">ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ø¯ÙŠØ±</button>
                          <button data-uid="${uid}" data-action="reject" class="py-1 px-3 rounded-md delete-btn text-white text-sm hover:bg-red-700 transition">Ø­Ø°Ù</button>
                      `;
              } else if (profile.role === "admin") {
                actionButtons = `<button data-uid="${uid}" data-action="demote" class="py-1 px-3 rounded-md bg-gray-600 text-white text-sm hover:bg-gray-500 transition">Ø¥Ù„ØºØ§Ø¡ Ø¯ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±</button>`;
              }

              userCard.innerHTML = `
                      <div class="mb-2 md:mb-0 text-center md:text-right">
                          <p class="font-bold gold-color">${
                            profile.name
                          } (${statusBadge})</p>
                          <p class="text-sm text-gray-400">Ø§Ù„Ø¨Ø±ÙŠØ¯: ${
                            profile.email
                          }</p>
                          <p class="text-xs text-gray-500">ID: ${uid.substring(
                            0,
                            8
                          )}... | Ù…Ø³Ø¬Ù„ ÙÙŠ: ${new Date(
                profile.createdAt
              ).toLocaleDateString("ar-EG")}</p>
                      </div>
                      <div class="space-x-2 space-x-reverse flex justify-center w-full md:w-auto mt-2 md:mt-0">
                          ${actionButtons}
                      </div>
                  `;
              pendingUsersList.appendChild(userCard);
            });

            pendingUsersList.querySelectorAll("button").forEach((btn) => {
              btn.addEventListener("click", handleUserAction);
            });
          },
          (error) => {
            console.error("Error listening to users:", error);
            pendingUsersList.innerHTML = `<p class="text-red-500">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${error.message}. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firestore.</p>`;
          }
        );
      }

      // **************** Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ****************
      async function handleUserAction(e) {
        const docId = e.currentTarget.dataset.uid;
        const action = e.currentTarget.dataset.action;
        const userDocRef = doc(db, "artifacts", appId, "user_profiles", docId);

        if (!db || !isUserAdmin || !isAdminMode) {
          showMessage(
            currentUserInfoEl,
            "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.",
            true
          );
          return;
        }

        showMessage(
          currentUserInfoEl,
          `Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (${action}) Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...`,
          false
        );

        try {
          if (action === "approve") {
            await updateDoc(userDocRef, { isApproved: true, role: "student" });
          } else if (action === "set-admin") {
            await updateDoc(userDocRef, { isApproved: true, role: "admin" });
          } else if (action === "demote") {
            await updateDoc(userDocRef, { role: "student" });
          } else if (action === "reject") {
            await deleteDoc(userDocRef);
          }
          showMessage(
            currentUserInfoEl,
            `âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­: ${action}`,
            false
          );
        } catch (error) {
          console.error(`Error performing action (${action}):`, error);
          showMessage(
            currentUserInfoEl,
            `âŒ ÙØ´Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: ${error.message}`,
            true
          );
        }
      }

      // **************** Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø¯Ø±ÙˆØ³/Ø´Ø®ØµÙŠØ§Øª/Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª) ****************
      async function handleDelete(e) {
        const docId = e.currentTarget.dataset.docId;
        const docType = e.currentTarget.dataset.type;

        if (!isUserAdmin || !isAdminMode) {
          return;
        }

        let collectionPath;

        switch (docType) {
          case "lesson":
            collectionPath = "history_lessons";
            break;
          case "character":
            collectionPath = "historical_characters";
            break;
          case "quiz":
            collectionPath = "quizzes";
            break;
          default:
            return;
        }

        try {
          const docRef = doc(
            db,
            "artifacts",
            appId,
            "public",
            "data",
            collectionPath,
            docId
          );
          await deleteDoc(docRef);
        } catch (e) {
          console.error(`Error removing ${docType} document: `, e);
          showMessage(currentUserInfoEl, `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ${e.message}`, true);
        }
      }

      // **************** Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ø²Ø± Ø§Ù„Ø¨Ø­Ø« ****************
      userSearchInput?.addEventListener("input", () => {
        loadAllUsers();
      });
    </script>
  </body>
</html>
